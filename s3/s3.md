S3 es un block based Storage
Los casos de uso suelenser
- Log Files
- Media Video Images
- CI/CD Artifacts

Objects are uploaded to S3, an object has
Key - The file name
Value - File Data
VersionID/metadata/otherinformation

S3 have flatFile structure

Los buckets tienen que tener nombres unicos por que se accedera a ellos por URL
El peso maximo de un archivo es 5TB
Puede tener infintos numeros de objetos
Una cuenta puede tener 1000 buckets

# Storage Classes
Te permiter optimizar el tipo de acceso o data que se va a ir accediendo
- Standard: tiene costo per giga/month, la data esta disponible inmediatamente, puedes hacer archivos publicos, costo por extraccion
- Standard-IA: Infrequent Access, mas barato el gb pero mas cara la extraccion
- One Zone-IA: los objetos solo son guardados en una availability zone, es aun mas barato por gb guardado
- Glacier-Instant: Lowcost para IA, obtienes info inmediatamente
- Glacier-Flexible: La data no es accesible inmediatamente, no se abren al publico, menor precio por gb mayor por egreso, se puede extraer entre 1-5 minutos, 3-5 horas, 5-12 horas
- Glacier Deep Archive: El mas barato por gb
- S3 Intelligent Tiering, optimiza tus costos de almacenamiento moviendo la data a los servicios mas optimos

# CLI commands

> aws s3 ls
  lista todas las buckets

> aws s3 mb s3://newbucket --region us-east-1
  crea una bucket

> aws s3 rb s3://newbucket
  elimina la bucket

> aws s3 rb s3://newbucket --force
  elimina la bucket, elimina primero todos los archivos dentro

> aws s3 ls s3://newbucket
  imprime el contenido de una bucket

> aws s3 cp file1 s3://newbucket
  copy files

> aws s3 cp s3://newbucket/file1 /tmp
  Copia a tu maquina local

> aws s3 cp s3://newbucket/file1 s3://bucket2
  copia de una bucket -> bucket

> aws s3 cp media s3://newbucket --recursive
  copia un folder, los mismos patrones de files se pueden usar aqui

> aws s3 mv file1 s3://newbucket
  mueve archivos, tambien se puede mover a una maquina local o entre buckets

> aws sync / s3://bucket
  te ayuda a sincronizar directorios entre buckets, hace que tengan exactamente lo mismo entre buckets o maquinas, se agregan entre cada sync como un git commit

# S3 ACLs & Resource Policies
Aqui se configura el acceso a las buckets

Las claves comunes en el json de las policies son
- Sid, es un nombre arbitrario que le das a una regla, es un identificador: String
- Principal: Determina a quines se les aplica esa regla: Record<string, any> | string
- Effect, determina si permites o restringes algo: string
- Action Cosas que se les permite a los usuarios: string[]
- Resource: tiene ARN de los servicios usados string[]

# Versioning
Te permite como git trackear cambios y evitar perdida de informacion
- Existen unversioned buckets, versioning Enabled y VErsioning Supsended
- Una vez versionada una bucket no se puede unversionar
- Cuando haces push de objetos ya existentes se elimina la ocurrencia, y se le agrega una version diferente
- Cuando eliminas un objeto se crea un Delete marker, que es otra version nueva del archivo
- Siempre obtienes la ultima version
- El versioning involucra un precio, cada version tiene un precio y depende del peso de cada version

# Lifecycle Policies
- Puedes hacer que pasando un tiempo tus servicios cambien de version por ejemplo
S3 Standard -> S3 Glacier Instant Retrieval, si despues de 2 meses quieres que cambie el tipo
- Igual se puede borrar un archivo o mover despues de un tiempo
- Solo puedes bajar de Standard a Glacier automaticamente

# Static Hosting
- Puedes usar esto para guardar websites tipo catalogos en HTML puro, puedes usar HTML CSS JS e imagenes

# Replication
- Te permite copiar automaticamente objetos entre distintas buckets
- Ayuda a proteccion
- Puede ser un requerimiento legal
- Gurda informacion en dinstintas regiones
- Mantiene informacion cerca de los servidores que usas

## Types of replication

> Same region Replication
> Cross-Region Replication
> Multi-destination Replication

> Bi directional replication: puedes hacer que la direccion de la copia vaya en una o dos direcciones un caso comun es que dev refleje los cambios de Prod pero no a la inversa

- Delete markers no son replicadoos
- La replicacion no ocurre inmediatamente, requiere un tiempo para verse reflejada

# S3 Encryption
Tipos de encripcion
> In Transit (SSL/TLS)
> CLient-Side & Server side Encription

- En s3 usamos server side encription, se usa Server-Side Encryption with amazon s3-managed keys (SSE-S3)
- Server-side encrtyption with customer provided keys (SSE-C)
- Server-Side Encryption with Key Management Service Keys (SSE-KMS)

# Pre-Signed URLs
Si buscas compartir informacion con usuarios no autorizados, para esto usas Pre-signed URL, que contienen informacion de login de un usuario

Esto puede ser usado en estos casos
- Tienes un servicio video-hosting, si un usuario pide informacion se la das dependiendo las condiciones
- Puedes retornar el link en vez de la imagen para que no tenga tanta carga el intermediario
- Las pre-signed URL tienen que tener una fecha de expiración

# Object Lock
Evita que una persona borre permanentemente o sobreescriba data, ayuda a ciertas regulaciones
- Se pueden agregar retentions periods, que tras pasar unos años permite el borrar algo
- Existe el Governance mode, la mayoria de los usuarios no pueden borrarlos o modificar, solo puede gente con Bypass Governance Retention 
- Compliance Mode: Los usuarios no pueden borrar o modificar gente durante el retention Period, esto incluye a el Root user, solo puedes borrarlas borrando la cuenta de AWS
- Legal Hold, esto permite que los archivos se mantengan sin modificar durante un tiempo indefinido, solo pueden ser modificados por usuarios con PutObjectLegalHold Permission
- Tiene que estar habilitado el versionamiento

# Access Logs
Proveen informacion de los requests recibidos en tu bucket, se usan para auditar y por razones de seguridad, te permite saber como se usan los buckets, son guardadas en otro s3 bucket puedes ver el
- Bucket Owner
- Bucket name
- Timestamp
- Remote IP
- Requester
- REquestID
- Operating HTTP Method
- Status Code

Puedes hacer Inventorys reports estos tienen
- Bucket Name
- Key Name
- Version ID
- Size
- Las modified
- Storage class
- Replication status
- Encription
- Object lock

# Access Points
Es un endpoint de red con un nombre único que está vinculado a un bucket.
Cada access point tiene su propia política de acceso (access point policy), independiente de la política general del bucket.
Permite definir accesos específicos para aplicaciones, equipos o usuarios, sin tener que modificar la única bucket policy una y otra vez.